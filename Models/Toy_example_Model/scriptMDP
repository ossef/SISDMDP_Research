# -----------! pour lancer et obtenir temps d'execution en seconde du script : "time -p ./script" !--------------

#!/bin/bash
BufferSize='3';  #Capacité de la file, 5
deadline='3';    #Deadline de remplissage, 3

#Generation de la chaine de markov
gcc -O2 generMarkov.c -o genMarkov

#Re-ordonner la matrice
gcc -O2 Re-order-Matrice-New.c -o ReOrder-New

#Calcul de la distribution stationnaire
gcc -O2 bis-newgthcreux.c -o sparsegthLD

#generation du fichier TGF
gcc -O2 Lam2TGF.c -o lamtgf

#Generate Actions distributions
K=2        # correspond à "NbRelease" dans "const.h"
DEN=10     # Diviseur (i.e pas) pour creer les vecteurs de proba
ACTIONS_FILE="Actions.txt"
python3 generActions.py --k "$K" --den "$DEN" --out "$ACTIONS_FILE"

# Lire le nombre d'actions (1ère ligne)
Actions=$(head -n 1 "$ACTIONS_FILE")

for ((i=0; i<$Actions; i++))
do

    model="Model_a${i}"  #Nom du model créé

    if test -e $model.cd
    then rm $model.cd
    fi

    if test -e $model.sz
    then rm $model.sz
    fi

    if test -e $model.Rii
    then rm $model.Rii
    fi

    if test -e $model.pi
    then rm $model.pi
    fi

    ./genMarkov -f $model $deadline $BufferSize $i

    ./sparsegthLD -f "$model"  

    ./ReOrder-New $model

    ./lamtgf -f "$model-reordre"


    rm $model.cd
    rm $model.sz
    rm $model.Rii
    rm $model.pi

done

#Calcul de la distribution stationnaire
#gcc gthLD.c -o gthLD 
#./gthLD -f $model Rii




